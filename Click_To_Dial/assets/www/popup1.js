/*
 * JS for popup1 generated by Exadel Tiggzi
 *
 * Created on: Monday, June 18, 2012, 05:36:10 AM (PDT)
 */
/************************************
 * JS API provided by Exadel Tiggzi  *
 ************************************/
/* Setting project environment indicator */
Tiggr.env = "apk"; /* Object & array with components "name-to-id" mapping */
var n2id_buf = {
    'mobilegrid2': 'j_37',
    'mobilegridcell3': 'j_38',
    'mobileimage3': 'j_39',
    'mobilegridcell4': 'j_40',
    'popLblName': 'j_41',
    'telnput': 'j_42',
    'mobilebutton3': 'j_43'
};
if ("n2id" in window && window.n2id !== undefined) {
    $.extend(n2id, n2id_buf);
} else {
    window.n2id = n2id_buf;
}
Tiggr.AppPages = [{
    "name": "mobilescreen1",
    "location": "mobilescreen1.html"
}, {
    "name": "mobilescreen2",
    "location": "mobilescreen2.html"
}, {
    "name": "popup1",
    "location": "popup1.html"
}, {
    "name": "current",
    "location": "popup1.html"
}];
Tiggr.CurrentScreen = 'j_33';

function navigateTo(outcome, useAjax) {
    Tiggr.navigateTo(outcome, useAjax);
}

function adjustContentHeight() {
    Tiggr.adjustContentHeight();
}

function adjustContentHeightWithPadding() {
    Tiggr.adjustContentHeightWithPadding();
}

function unwrapAndApply(selector, content) {
    Tiggr.unwrapAndApply(selector, content);
}

function setDetailContent(pageUrl) {
    Tiggr.setDetailContent(pageUrl);
}
/**********************
 * SECURITY CONTEXTS  *
 **********************/
var xAuthSecurityContext = new XAuthSecurityContext({
    authorizationErrorStatusCodes: [401, 403],
    'consumerKey': 'syncdev@interwise.com',
    'consumerSecret': 'Aa123456',
    serviceProvider: {
        'signatureMethod': 'hmac-sha1',
        'requestTokenURL': 'https://rally1.rallydev.com/slm/webservice/1.33/subscription?stylesheet=/slm/doc/webservice/browser.xsl',
        'requestType': 'get',
        'responseDataType': 'text'
    },
    onLoginError: function(xhr, textStatus, errorThrown) {
        alert("success");
    },
    onAuthorizationError: function(xhr, textStatus, errorThrown) {
        alert("fails");
    },
});
/*******************************
 *      SERVICE SETTINGS        *
 ********************************/
/*************************
 *      SERVICES          *
 *************************/
var Contacts_service = new Tiggr.ContactsService({});
var MyData = new Tiggr.RestService({
    'url': 'https://graph.facebook.com/me/friends',
    'dataType': 'json',
    'type': 'get',
});
var getToken = new Tiggr.RestService({
    'url': 'https://graph.facebook.com/oauth/access_token',
    'dataType': 'json',
    'type': 'get',
});
var GetMyData = new Tiggr.RestService({
    'url': 'https://graph.facebook.com/me',
    'dataType': 'json',
    'type': 'get',
});
/*************************
 * NONVISUAL COMPONENTS  *
 *************************/
var datasources = [];
/************************
 * EVENTS AND HANDLERS  *
 ************************/
// screen onload
screen_BB40_onLoad = j_33_onLoad = function() {
    createSpinner("res/lib/jquerymobile/images/ajax-loader.gif");
    Tiggr.__registerComponent('mobilegrid2', new Tiggr.BaseComponent({
        id: 'mobilegrid2',
        context: '#j_36'
    }));
    Tiggr.__registerComponent('mobilegridcell3', new Tiggr.BaseComponent({
        id: 'mobilegridcell3',
        context: '#j_36'
    }));
    Tiggr.__registerComponent('mobileimage3', new Tiggr.BaseComponent({
        id: 'mobileimage3',
        context: '#j_36'
    }));
    Tiggr.__registerComponent('mobilegridcell4', new Tiggr.BaseComponent({
        id: 'mobilegridcell4',
        context: '#j_36'
    }));
    Tiggr.__registerComponent('popLblName', new Tiggr.BaseComponent({
        id: 'popLblName',
        context: '#j_36'
    }));
    Tiggr.__registerComponent('telnput', new Tiggr.BaseComponent({
        id: 'telnput',
        context: '#j_36'
    }));
    Tiggr.__registerComponent('mobilebutton3', new Tiggr.BaseComponent({
        id: 'mobilebutton3',
        context: '#j_36'
    }));
    for (var idx = 0; idx < datasources.length; idx++) {
        datasources[idx].__setupDisplay();
    }
    screen_BB40_elementsExtraJS();
    var curTel = localStorage.getItem("CurTel");
    var fbperson = localStorage.getItem("fb_" + curTel);
    pperson = JSON.parse(fbperson);
    Tiggr('telnput').val(pperson.tel); // = pperson.tel;
    Tiggr('mobileimage3').attr("src", pperson.pic); // = pperson.pic;
    Tiggr('popLblName').text(pperson.name); // = pperson.name;
    //alert(Tiggr('mobileimage3').attr("src"));
    //localStorage.setItem("fb_" + value, JSON.stringify(fbperson));
    j_33_deviceEvents();
    j_33_windowEvents();
    screen_BB40_elementsEvents();
}
// screen window events
screen_BB40_windowEvents = j_33_windowEvents = function() {
    $('#j_33').bind('pageshow orientationchange', function() {
        adjustContentHeightWithPadding();
    });
}
// device events
j_33_deviceEvents = function() {
    document.addEventListener("deviceready", function() {});
}
// screen elements extra js
screen_BB40_elementsExtraJS = j_33_elementsExtraJS = function() {
    // modalPanel (screen-BB40) extra code
}
// screen elements handler
screen_BB40_elementsEvents = j_33_elementsEvents = function() {
    $("a :input,a a,a fieldset label").live({
        click: function(event) {
            event.stopPropagation();
        }
    });
    $('#j_36 [name="mobilebutton3"]').die().live({
        vclick: function() {
            if (!$(this).attr('disabled')) {
                var curTel = localStorage.getItem("CurTel");
                var fbperson = localStorage.getItem("fb_" + curTel);
                pperson = JSON.parse(fbperson);
                pperson.tel = Tiggr('telnput').val();
                localStorage.setItem("fb_" + curTel, JSON.stringify(pperson));
                //Tiggr.navigateTo('mobilescreen2');
                top.location = 'mobilescreen2.html';
            }
        },
    });
}
$("body").undelegate("pagebeforeshow").delegate("#j_33", "pagebeforeshow", function(event, ui) {
    j_33_onLoad();
});